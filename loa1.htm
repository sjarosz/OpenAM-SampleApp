<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-GB">
<head>
	<title>Sample Application/Portal</title>
	<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="screen.css" media="screen" />
    <script type="text/javascript" src="jquery-2.1.1.js"></script>  
    <script type="text/javascript" src="config.js"></script>  
    <script type="text/javascript" src="functions.js"></script>  


    <script type="text/javascript" src="data-driver.js"></script>


<script>
if (encodeURIComponent(getSessionHandle())!=null) {


		//$.ajax({
                //url: "https://forgerock.agency-x.gov:9443/openam/json/users/?_action=idFromSession",
                //type: 'POST',
		//headers: { "iplanetDirectoryPro":encodeURIComponent(getSessionHandle())},
                //success: function(msg) {
		  //alert(msg);
                  //return true;
                //},
                //error: function (xhr, ajaxOptions, thrownError) {
                  //alert(xhr.status);
                  //alert(thrownError);
                  //alert(xhr.responseText);
                //}
        //});


          //  $.ajax({     // Check with OpenAM to see if session is valid
          //      url: getBaseURL() +validtoken,
          //      type: "GET",
          //      data: {
          //          "tokenid": encodeURIComponent(getSessionHandle())
          //      },
          //  }).done(function (data) {
          ///       if (/false/i.test(data)) {
          //          window.location.replace(AuthNUrl("realm=/"));   // Session Invalid, force login
          //       }
          //  }).fail(function (data) {
          //          alert("Service Error");  // If repeated error something went wrong.  
          //  });

} else {

}

// end validate token

// get attributes / set session vars

                     uri = "/openam/identity/attributes?subjectid="+encodeURIComponent(getSessionHandle());
                     attributes = "attributenames=mail&"+
                                  "attributenames=employeeNumber&"+  
                                  "attributenames=uid&"+  
                                  "attributenames=Service&"+                             
                                  "attributenames=AuthLevel&"+
                                  "attributenames=maxsessiontime&"+
                                  "attributenames=maxidletime&"+
                                  "attributenames=idletime&"+                                  
                                  "attributenames=timeleft&"+                              
                                  "attributenames=givenName&"+
                                  "attributenames=UserId&"+
                                  "attributenames=telephoneNumber&"+
                                  "attributenames=sn&"+
                                  "attributenames=cn";

                          $.get(uri+"&"+attributes, function(response) { 
x = response.split('\n');


var attString="";
for (var i = 1; i < x.length-1; i=i+2) {
	key=x[i].split('=');
	value=x[i+1].split('=');
	console.log(key[1]+" "+value[1]);
	sessionStorage.setItem(key[1],value[1]);
	attString=attString+key[1]+" = "+value[1]+"\n";
}


	sessionStorage.setItem('loa',sessionStorage.getItem('AuthLevel'));
	sessionStorage.setItem('attString',attString);
                     //$.get(uri, function(response) { 

                 })

// end get attributes / set session vars

    function getgeoip(json){ 

    	document.getElementById('geo').innerHTML = json.city+", "+json.country+" "+json.postal_code;
    	document.getElementById('ip').innerHTML = json.ip;
    }

	function blink(id1, content1) {
		 var elm = document.getElementById(id1); 
		 elm.innerHTML = content1; 
	}



	function doLoginForm(){
		$.ajax({
                url: "https://forgerock.agency-x.gov:9443/openam/json/authenticate",
                type: 'POST',
		headers: { 
			 "Content-Type": "application/json",
			 "X-OpenAM-Username" : "demo",
			 "X-OpenAM-Password" : "changeit"
		},
                success: function(msg) {
		  alert(msg.tokenId);
			var cookieName = 'iPlanetDirectoryPro';
			var cookieValue = msg.tokenId;
			var myDate = new Date();
			document.cookie = cookieName +"=" + cookieValue  
                  			+ ";domain=.agency-x.gov;path=/";
                  return true;
                },
                error: function (xhr, ajaxOptions, thrownError) {
                  alert(xhr.status);
                  alert(thrownError);
                  alert(xhr.responseText);
                }
        	});
	}



</script>


</head>
<body>
	<h1>Sample Application/Portal</h1>
<div id="header">

	<h2>Welcome, <b id='givenname1'></b> <b id='sn1'> </b></h2>
	<ul>
                 &nbsp;
		<li id='loa0'><a href="loa0.htm" class="active"> Public Access</a></li>
		<li id='loa1'><a href="loa1.htm">My Apps</a></li>
		<li id='loa2'><a href="loa2.htm">Internal Only</a></li>
		<li id='loa3'><a href="loa3.htm">Partner Access</a></li>
		<li id='loa4'><a href="loa4.htm">HIGH SECURITY</a></li>
		
	</ul>
	<p id="layoutdims"><font color='green'>
		<b id='sn2'> </b>, <b id='givenname2'> </b>	
	</font>
		 ||<a href="https://forgerock.agency-x.gov:9443/openam/UI/Logout">Sign Off</a> | <a href="self.htm">Self Service</a> | <strong>Identity Management</strong></p>
</div>

<div class="colmask threecol">
	<div class="colmid">
		<div class="colleft">
			<div class="col1">
				<!-- Column 1 start -->
                                    <form id="login" action="#" onsubmit="return doLoginForm()">
                                        <h1>Log In</h1>
                                        <fieldset id="inputs">
                                            <input id="username" name="token1" type="text" placeholder="User" autofocus=required>   
                                            <input id="password" name="token2" type="password" placeholder="Password" required>
                                        </fieldset>
                                        <fieldset id="actions">
                                            <input type="submit" id="submit" value="Log in">
                                            <a href="">Forgot your password?</a>&nbsp;||<a href="">Lost or forgot PIV/CAC</a>||<a href="">Register</a>&nbsp;
                                        </fieldset>
                                    <a href="https://forgerock.agency-x.gov:9443/openam/UI/Login?module=DataStore&ForceAuth=true&goto=https%253A%252F%252Fforgerock.agency-x.gov%253A9443%252FREST%252Floa1.htm" id='login-up'>Login as registered user</a> </br>
                                    <a href="#" id='fccx-url'>Login using CONNECT.GOV (FCCX)</a> </br>
                                    <a href="">Login Local with PIV/CAC</a> </br>
                                    </form>

 									</br>

 									<p id='c1'>
 										
									</p>
									<p id='c2'>

									</p>
									<p id='c3'>
										
									</p>
									<p id='c4'>
										
									<p id='c5'>
										
 									</p>
                 <!-- Column 1 end -->


			</div>
			<div class="col2">
				<!-- Column 2 start -->
				<h2>Public Info</h2>
				Information everyone has access to.  Public info that is core to mission statement.
				<h2>Context Specific Info</h2>
				<p>Information such as device or location that displays information about user (albiet anonymous) such as zipcode related info.</p>

				<font color='blue'><p id='geo'></p></font>
				<font color='blue'><p id='ip'></p></font>
				<font color='blue'><p id='deviceInfo'></p></font>

				<table id='context-table'></table>


				<h2>User Specific Information</h2>
                                <p>User is no longer anyoymous and therefore specific inforation related to user logged in session can be displayed</p> 


				<font color='blue'>                                
                			<pre id="userinfo" rows="40" cols="100"></pre>
				</font>

				<!-- Column 2 end -->
			</div>
			<div class="col3">
				<!-- Column 3 start -->
				<div id="ads">
					<h2>Enterprise Domain Info</h2>
						Info related context and identity info available.	Example, AD Domain and SAMACCOUNT-NAME
						<font color='blue'>
							<p id='uname'></p>
							<p id='primary-domain'></p>						
							<p id='email'></p>
						</font>
					
					<div id='register'>
						<h2>Register for an Account:</h2>
							Info related to why someone would want to register here or at FCCX.

							<a href="">Register Now</a>
					</div>
					<div id="workflow">
						<h2>Workflow Items:</h2>
	                                    <a href="">1) Action Required: NEEDS APPROVAL</a></br>
	                                    <a href="">2) Status: WAITING UPON Jack, Jak</a></br>
	                                    <a href="">3) Action Required: NEEDS APPROVAL</a></br>
	                                    <a href="">...more</a></br>

							<h2>Alerts:</h2>
							<p>Request for access to ProjectX: <font color='green'>COMPLETED/GRANTED</font></p>
							<p>Request for access to ProjectY: <font color='red'>COMPLETED/DENIED</font></p>
							<p>NOTIFY: User xmen3@red.com added to APP-ABC</p>
							<a href="">details</a></br>
					</div>	
				</div>		
				<!-- Column 3 end -->
			</div>
		</div>
	</div>
</div>
<div id="footer">
	<p>Powered By FORGEROCK <a href="https://forgerock.agency-x.gov:9443/openam/UI/Login?ForceAuth=true&service=adminconsoleservice&goto=https://forgerock.agency-x.gov:9443/openam/base/AMAdminFrame">OpenAM</a>||<a href="">OpenIG</a>||<a href="">OpenIDM</a>||<a href="">OpenDJ</a></p>
</div>

</script>


<script>

	document.getElementById("workflow").style.display="none"; 
	document.getElementById("fccx-url").href=sessionStorage.getItem('fccx-url');  
	
	//subject attributes

	blink('userinfo', sessionStorage.getItem('attString'));
	if (sessionStorage.getItem('UserId')!='anonymous') {
		blink('userinfo', sessionStorage.getItem('attString'));
		blink('uname', sessionStorage.getItem('uname'));		
		blink('primary-domain', sessionStorage.getItem('primary-domain'));
		blink('email', sessionStorage.getItem('email'));	
		document.getElementById("register").style.display="none";  	
	}	

	blink('deviceInfo', sessionStorage.getItem('deviceInfo'));
	if (sessionStorage.getItem('UserId')!='anonymous') {
		document.getElementById("login").style.display="none";  
		blink('sn1', sessionStorage.getItem('sn'));
		blink('sn2', sessionStorage.getItem('sn'));
		blink('givenname1', sessionStorage.getItem('givenname'));
		blink('givenname2', sessionStorage.getItem('givenname'));
	} else {
		document.getElementById("header").style.display="none";  
	}

	switch (sessionStorage.getItem('loa')) {
	  case '1': 
	  			blink('c1', sessionStorage.getItem('c1'));	  
	  			blink('c2', sessionStorage.getItem('c2'));
				document.getElementById("loa1").style.fontWeight="bold";
				document.getElementById("loa2").style.fontStyle="italic";
				document.getElementById("loa2").style.fontSize="small";
				document.getElementById("loa3").style.fontStyle="italic";				
				document.getElementById("loa3").style.fontSize="small";
				document.getElementById("loa4").style.fontStyle="italic";
				document.getElementById("loa4").style.fontSize="small";			
	            break;
	  case '2': 
	  			blink('c1', sessionStorage.getItem('c1'));	  
	  			blink('c2', sessionStorage.getItem('c2'));	  
	  			blink('c3', sessionStorage.getItem('c3'));
				document.getElementById("loa1").style.fontWeight="bold";
				document.getElementById("loa2").style.fontWeight="bold";
				document.getElementById("loa3").style.fontStyle="italic";				
				document.getElementById("loa3").style.fontSize="small";
				document.getElementById("loa4").style.fontStyle="italic";
				document.getElementById("loa4").style.fontSize="small";					
	            break;
	  case '3': 
	  			blink('c1', sessionStorage.getItem('c1'));
	  			blink('c2', sessionStorage.getItem('c2'));	  
	  			blink('c3', sessionStorage.getItem('c3'));
	  			blink('c4', sessionStorage.getItem('c4'));
				document.getElementById("loa1").style.fontWeight="bold";
				document.getElementById("loa2").style.fontWeight="bold";
				document.getElementById("loa3").style.fontWeight="bold";
				document.getElementById("loa4").style.fontStyle="italic";
				document.getElementById("loa4").style.fontSize="small";	
	            break;
	  case '4': 
	  			blink('c1', sessionStorage.getItem('c1'));
	  			blink('c2', sessionStorage.getItem('c2'));	  
	  			blink('c3', sessionStorage.getItem('c3'));
	  			blink('c4', sessionStorage.getItem('c4'));
	  			blink('c5', sessionStorage.getItem('c5'));
				document.getElementById("loa0").style.fontWeight="bold";
				document.getElementById("loa1").style.fontWeight="bold";
				document.getElementById("loa2").style.fontWeight="bold";
				document.getElementById("loa3").style.fontWeight="bold";
				document.getElementById("loa4").style.fontWeight="bold";	
	            break;

	  default:  
	  			blink('c1', sessionStorage.getItem('c1'));
				document.getElementById("loa0").style.fontWeight="bold";
				document.getElementById("loa1").style.fontWeight="bold";
				document.getElementById("loa2").style.fontWeight="bold";
				document.getElementById("loa3").style.fontWeight="bold";
				document.getElementById("loa4").style.fontWeight="bold";	
	}

	
</script>

<script type="application/javascript" >
		$.ajax({
                url: "http://www.telize.com/geoip",
                type: 'GET',
                success: function(json) {
    			document.getElementById('geo').innerHTML = json.city+", "+json.country+" "+json.postal_code;
    			document.getElementById('ip').innerHTML = json.ip;
                  return true;
                },
                error: function (xhr, ajaxOptions, thrownError) {
                  alert(xhr.status);
                  alert(thrownError);
                  alert(xhr.responseText);
                }
        });
</script>

</body>
</html>

