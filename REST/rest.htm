<html>
<head>
    <title>Simple REST Sample Application</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <META HTTP-EQUIV=”CACHE-CONTROL” CONTENT=”NO-CACHE”>
    <META HTTP-EQUIV=”EXPIRES” CONTENT=”Mon, 22 Jul 2000 11:12:01 GMT”>
    <META HTTP-EQUIV=”PRAGMA” CONTENT=”NO-CACHE”> 

    <link rel="stylesheet" type="text/css" href="../brand/layout.css">
    <link rel="stylesheet" type="text/css" href="../brand/style.css">

    <script type="text/javascript" src="../js/config.js"></script>  
    <script type="text/javascript" src="../js/functions.js"></script>  
    <script type="text/javascript" src="/openam/XUI/libs/jquery-2.1.1-min.js"></script>     

<!-- 
Acquire pre-existing session and check it's validity with OpenAM's Session Service
This Session Service is key to web-based single sign-on that supports notions such as sso across clustered environments, application-based session timeouts, single logout functions & maximum number of sessions a user can have simultanously all without needing to manage these conscepts in each of the target applications -->
    <script type="text/javascript">
    //Get Authenticated Session for end-user (AKA resource owner) browser
    //Three step proccess:   (1)Get Session Handle, (2) Validate Session (3)if invalid, then have user login -->
<<<<<<< HEAD
<<<<<<< HEAD
     	var endpoint=getBaseURL() +"/openam/json/sessions/"+getSessionHandle()+"?_action=validate";  
            $.ajax({     // Check with OpenAM to see if session is valid
                url: endpoint,
                type: "POST",
		dataType: "json",
     		accepts: "json"
=======
=======
>>>>>>> origin/master


            $.ajax({     // Check with OpenAM to see if session is valid
                url: getBaseURL(),
                type: "GET",
                data: {
                    "tokenid": encodeURIComponent(getSessionHandle())
                },
>>>>>>> origin/master
            }).done(function (data) {
                 if (!data.valid) {
                    window.location.replace(AuthNUrl("realm=/"));   // Session Invalid, force login
                 }
            }).fail(function (data) {
                    console.log("Service Error");  // If repeated error something went wrong.  
            });

    </script>

</head>
<body>


<!-- Layout Header -->
<div id="header">  
    <table><tr>
        <td width=600><img src="../brand/logo.png"/></td>     
    </tr></table>
</div>

<!-- Layout Page -->
<div class="colmask fullpage">
    <div class="col1">
        <!-- Column 1 start -->

<!-- Layout Page -->
<div class="colmask fullpage">
    <div class="col1">
        <!-- Column 1 start -->

                <pre id="userinfo" rows="40" cols="100"></pre>

                <script type="text/javascript">    
                     uri = "/openam/identity/attributes?subjectid="+encodeURIComponent(getSessionHandle());
                     attributes = "attributenames=mail&"+
                                  "attributenames=employeeNumber&"+  
                                  "attributenames=Service&"+                             
                                  "attributenames=AuthLevel&"+
                                  "attributenames=maxsessiontime&"+
                                  "attributenames=maxidletime&"+
                                  "attributenames=idletime&"+                                  
                                  "attributenames=timeleft&"+                              
                                  "attributenames=givenName&"+
                                  "attributenames=UserId&"+
                                  "attributenames=pwdLastSet&"+
                                  "attributenames=telephoneNumber&"+
                                   "attributenames=customAttribute&"+                                                                 
                                  "attributenames=sn&"+
                                  "attributenames=cn";

                          $.get(uri+"&"+attributes, function(response) { $("#userinfo").html(response);
                     //$.get(uri, function(response) { $("#userinfo").html(response);  //Uncomment and replace with line above to have all available attributes returned rather than explicit list of attributes 
                 })
                </script>


       <!-- Column 1 end -->

    </div>
</div>



<!--  Layout Footer -->
<div id="footer">
    <p>A ForgeRock Demonstration Client Application&nbsp;&nbsp|&nbsp;&nbsp
    <a href="../REST/rest.htm">OpenAM REST</a>&nbsp;&nbsp|&nbsp;&nbsp  
    <a href="../oIDc/openidc.htm">OpenID Connect</a>&nbsp;&nbsp|&nbsp;&nbsp 
    <a href="/fedlet">SAML Fedlet</a>&nbsp;&nbsp|&nbsp;&nbsp               
    <a href="../oauth2/oauth2.htm">OAuth 2.0</a>&nbsp;&nbsp|&nbsp;&nbsp
    <a href="/openam/UI/Logout">Logout</a>&nbsp;&nbsp|&nbsp;&nbsp  
    </br>
</div>



</body>
</html>
